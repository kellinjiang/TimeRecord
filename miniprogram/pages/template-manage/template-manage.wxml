<!--æ¨¡æ¿ç®¡ç†é¡µé¢-->
<view class="container">

  <!-- é¡µé¢è¯´æ˜ -->
  <view class="page-tip">
    <text class="tip-icon">ğŸ“‹</text>
    <text class="tip-text">ç®¡ç†æ‚¨çš„å¸¸ç”¨æ¨¡æ¿ï¼Œå¿«é€Ÿå¡«å……è®°å½•å†…å®¹</text>
  </view>

  <!-- åˆ†ç±»ç­›é€‰ -->
  <view class="category-filter">
    <view
      class="category-item {{currentCategory === 'all' ? 'active' : ''}}"
      bindtap="filterCategory"
      data-category="all"
    >
      <text>å…¨éƒ¨</text>
    </view>
    <view
      class="category-item {{currentCategory === item ? 'active' : ''}}"
      wx:for="{{categories}}"
      wx:key="*this"
      bindtap="filterCategory"
      data-category="{{item}}"
    >
      <text>{{item}}</text>
    </view>
  </view>

  <!-- é»˜è®¤æ¨¡æ¿åŒºåŸŸ -->
  <view class="section">
    <view class="section-header">
      <text class="section-title">é»˜è®¤æ¨¡æ¿</text>
      <text class="section-subtitle">ç³»ç»Ÿå†…ç½®ï¼Œä¸å¯ç¼–è¾‘</text>
    </view>

    <view class="template-list">
      <view class="template-item" wx:for="{{filteredDefaultTemplates}}" wx:key="name">
        <view class="template-header">
          <view class="template-title-row">
            <text class="template-name">{{item.name}}</text>
            <view class="template-category">{{item.category}}</view>
          </view>
          <view class="template-badge">é»˜è®¤</view>
        </view>
        <view class="template-content">{{item.content}}</view>
        <view class="template-footer">
          <text class="template-usage">ä½¿ç”¨ {{item.usageCount || 0}} æ¬¡</text>
        </view>
      </view>
    </view>
  </view>

  <!-- è‡ªå®šä¹‰æ¨¡æ¿åŒºåŸŸ -->
  <view class="section">
    <view class="section-header">
      <view class="header-left">
        <text class="section-title">è‡ªå®šä¹‰æ¨¡æ¿</text>
        <text class="section-subtitle">{{filteredCustomTemplates.length}} ä¸ª</text>
      </view>
      <view class="add-btn" bindtap="showAddDialog">
        <text class="add-icon">+</text>
        <text class="add-text">æ·»åŠ </text>
      </view>
    </view>

    <!-- è‡ªå®šä¹‰æ¨¡æ¿åˆ—è¡¨ -->
    <view class="template-list" wx:if="{{filteredCustomTemplates.length > 0}}">
      <view class="template-item custom" wx:for="{{filteredCustomTemplates}}" wx:key="_id">
        <view class="template-header">
          <view class="template-title-row">
            <text class="template-name">{{item.name}}</text>
            <view class="template-category">{{item.category}}</view>
          </view>
          <view class="template-actions">
            <view class="action-btn edit-btn" bindtap="editTemplate" data-template="{{item}}">
              <text>ç¼–è¾‘</text>
            </view>
            <view class="action-btn delete-btn" bindtap="deleteTemplate" data-id="{{item._id}}" data-name="{{item.name}}">
              <text>åˆ é™¤</text>
            </view>
          </view>
        </view>
        <view class="template-content">{{item.content}}</view>
        <view class="template-footer">
          <text class="template-usage">ä½¿ç”¨ {{item.usageCount || 0}} æ¬¡</text>
          <text class="template-time">{{item.createTime}}</text>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{filteredCustomTemplates.length === 0}}">
      <text class="empty-icon">ğŸ“</text>
      <text class="empty-text">{{currentCategory === 'all' ? 'è¿˜æ²¡æœ‰è‡ªå®šä¹‰æ¨¡æ¿' : 'è¯¥åˆ†ç±»ä¸‹æ²¡æœ‰æ¨¡æ¿'}}</text>
      <text class="empty-tip">ç‚¹å‡»å³ä¸Šè§’"æ·»åŠ "æŒ‰é’®åˆ›å»º</text>
    </view>
  </view>

  <!-- æ·»åŠ /ç¼–è¾‘æ¨¡æ¿å¼¹çª— -->
  <view class="modal-mask" wx:if="{{showDialog}}" bindtap="hideDialog" catchtouchmove="preventMove">
    <view class="modal-dialog" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">{{isEditMode ? 'ç¼–è¾‘æ¨¡æ¿' : 'æ·»åŠ æ¨¡æ¿'}}</text>
        <view class="close-btn" bindtap="hideDialog">
          <text>âœ•</text>
        </view>
      </view>

      <view class="modal-body">
        <!-- æ¨¡æ¿åç§° -->
        <view class="form-item">
          <text class="form-label">æ¨¡æ¿åç§°</text>
          <input
            class="form-input"
            placeholder="è¯·è¾“å…¥æ¨¡æ¿åç§°"
            value="{{formData.name}}"
            bindinput="onNameInput"
            maxlength="20"
          />
          <text class="char-count">{{formData.name.length}}/20</text>
        </view>

        <!-- é€‰æ‹©åˆ†ç±» -->
        <view class="form-item">
          <text class="form-label">é€‰æ‹©åˆ†ç±»</text>
          <view class="category-options">
            <view
              class="category-option {{formData.category === item ? 'active' : ''}}"
              wx:for="{{categories}}"
              wx:key="*this"
              bindtap="selectCategory"
              data-category="{{item}}"
            >
              <text>{{item}}</text>
            </view>
          </view>
        </view>

        <!-- æ¨¡æ¿å†…å®¹ -->
        <view class="form-item">
          <text class="form-label">æ¨¡æ¿å†…å®¹</text>
          <textarea
            class="form-textarea"
            placeholder="è¯·è¾“å…¥æ¨¡æ¿å†…å®¹ï¼Œæ”¯æŒæ¢è¡Œ"
            value="{{formData.content}}"
            bindinput="onContentInput"
            maxlength="500"
            auto-height
          />
          <text class="char-count">{{formData.content.length}}/500</text>
        </view>

        <!-- é¢„è§ˆ -->
        <view class="form-item">
          <text class="form-label">é¢„è§ˆæ•ˆæœ</text>
          <view class="template-preview">
            <view class="preview-template">
              <view class="preview-header">
                <text class="preview-name">{{formData.name || 'æ¨¡æ¿åç§°'}}</text>
                <view class="preview-category">{{formData.category}}</view>
              </view>
              <view class="preview-content">{{formData.content || 'æ¨¡æ¿å†…å®¹é¢„è§ˆ...'}}</view>
            </view>
          </view>
        </view>
      </view>

      <view class="modal-footer">
        <view class="modal-btn cancel-btn" bindtap="hideDialog">
          <text>å–æ¶ˆ</text>
        </view>
        <view class="modal-btn confirm-btn" bindtap="saveTemplate">
          <text>{{isEditMode ? 'ä¿å­˜' : 'æ·»åŠ '}}</text>
        </view>
      </view>
    </view>
  </view>

</view>
