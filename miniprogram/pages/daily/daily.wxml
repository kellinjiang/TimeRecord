<!--pages/daily/daily.wxml-->
<view class="container">
  <!-- é¡¶éƒ¨æ—¥æœŸåˆ‡æ¢ -->
  <view class="date-header">
    <view class="date-nav" bindtap="prevDay">
      <text class="nav-arrow">â€¹</text>
    </view>
    <picker
      mode="date"
      value="{{currentDate}}"
      bindchange="onDateChange"
      class="date-picker-trigger"
    >
      <view class="date-picker">
        <text class="current-date">{{currentDateStr}}</text>
        <text class="week-day">{{weekDayStr}}</text>
      </view>
    </picker>
    <view class="date-nav" bindtap="nextDay">
      <text class="nav-arrow">â€º</text>
    </view>
  </view>

  <!-- ä»Šæ—¥ç»Ÿè®¡å¡ç‰‡ -->
  <view class="stats-card">
    <view class="stats-title">ğŸ“Š ä»Šæ—¥ç»Ÿè®¡</view>

    <!-- è®°å½•æ•°ç»Ÿè®¡ -->
    <view class="stats-summary">
      <text class="summary-text">ä»Šæ—¥å…±è®°å½• </text>
      <text class="summary-count">{{stats.totalRecords}}</text>
      <text class="summary-text"> æ¡</text>
      <text class="summary-divider">|</text>
      <text class="summary-text">æ€»æ—¶é•¿ </text>
      <text class="summary-hours">{{stats.totalHours}}h</text>
    </view>

    <!-- æ ‡ç­¾æ—¶é•¿æŸ±çŠ¶å›¾ -->
    <view class="tag-chart-section" wx:if="{{stats.tagStats.length > 0}}">
      <view class="chart-title">ğŸ·ï¸ æ ‡ç­¾æ—¶é•¿åˆ†å¸ƒ</view>
      <view class="tag-chart-container">
        <!-- Yè½´åˆ»åº¦ -->
        <view class="y-axis">
          <view class="y-axis-item" wx:for="{{stats.yAxisLabels}}" wx:key="*this">
            <text class="y-axis-label">{{item}}h</text>
            <view class="y-axis-line"></view>
          </view>
        </view>

        <!-- æŸ±çŠ¶å›¾ -->
        <view class="tag-chart-bars">
          <view class="tag-chart-item" wx:for="{{stats.tagStats}}" wx:key="name">
            <view class="bar-wrapper">
              <view
                class="bar-fill"
                style="height: {{item.barHeight}}%; background-color: {{item.color}};"
              >
                <text class="bar-value" wx:if="{{item.hours > 0}}">{{item.hours}}h</text>
              </view>
            </view>
            <view class="bar-label">
              <text class="bar-icon">{{item.icon}}</text>
              <text class="bar-name">{{item.name}}</text>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- è®°å½•è¡¨æ ¼ -->
    <view class="record-table-section" wx:if="{{records.length > 0}}">
      <view class="chart-title">ğŸ“ æ—¶é—´è®°å½•</view>
      <view class="record-table">
        <view class="table-row table-header">
          <text class="col-time">æ—¶é—´æ®µ</text>
          <text class="col-content">å†…å®¹</text>
          <text class="col-duration">æ—¶é•¿</text>
          <text class="col-tag">æ ‡ç­¾</text>
        </view>
        <view class="table-row" wx:for="{{records}}" wx:key="_id" bindtap="editRecord" data-id="{{item._id}}">
          <text class="col-time">{{item.startTimeStr}} - {{item.endTimeStr || 'å¾…å®š'}}</text>
          <text class="col-content">{{item.content}}</text>
          <text class="col-duration">{{item.durationStr || '-'}}</text>
          <view class="col-tag">
            <text wx:for="{{item.tags}}" wx:for-item="tag" wx:key="name" class="mini-tag" style="background-color: {{tag.color}}20; color: {{tag.color}};">{{tag.icon}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- æ—¶é—´è½´ -->
  <view class="timeline-section">
    <view class="section-header">
      <text class="section-title">â° æ—¶é—´è½´</text>
      <text class="record-count">{{records.length}} æ¡è®°å½•</text>
    </view>

    <!-- è®°å½•åˆ—è¡¨ -->
    <view class="timeline-list" wx:if="{{records.length > 0}}">
      <view
        class="timeline-item"
        wx:for="{{records}}"
        wx:key="_id"
        bindtap="editRecord"
        data-id="{{item._id}}"
      >
        <!-- æ—¶é—´çº¿ -->
        <view class="timeline-line">
          <view class="timeline-dot"></view>
          <view class="timeline-connector" wx:if="{{index < records.length - 1}}"></view>
        </view>

        <!-- å†…å®¹å¡ç‰‡ -->
        <view class="record-card">
          <view class="record-header">
            <view class="record-time">
              <text class="time-start">{{item.startTimeStr}}</text>
              <text class="time-separator">-</text>
              <text class="time-end">{{item.endTimeStr || 'è¿›è¡Œä¸­'}}</text>
            </view>
            <view class="record-duration" wx:if="{{item.duration}}">
              <text>{{item.durationStr}}</text>
            </view>
          </view>

          <view class="record-content">
            <text>{{item.content}}</text>
          </view>

          <!-- å½•éŸ³æ’­æ”¾æŒ‰é’® -->
          <view class="record-audio" wx:if="{{item.audioPath}}" bindtap="playAudio" data-id="{{item._id}}" data-path="{{item.audioPath}}" catchtap="stopPropagation">
            <text class="audio-icon">{{item.isPlaying ? 'â¸' : 'ğŸ¤'}}</text>
            <text class="audio-text">{{item.isPlaying ? 'æ’­æ”¾ä¸­...' : 'ç‚¹å‡»æ’­æ”¾å½•éŸ³'}}</text>
          </view>

          <view class="record-tags" wx:if="{{item.tags && item.tags.length > 0}}">
            <view
              class="tag"
              wx:for="{{item.tags}}"
              wx:for-item="tag"
              wx:key="name"
              style="background-color: {{tag.color}}20; color: {{tag.color}}"
            >
              <text>{{tag.icon}} {{tag.name}}</text>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{records.length === 0}}">
      <text class="empty-icon">ğŸ“</text>
      <text class="empty-text">ä»Šå¤©è¿˜æ²¡æœ‰è®°å½•</text>
      <text class="empty-hint">ç‚¹å‡»é¦–é¡µå½•éŸ³æŒ‰é’®å¼€å§‹è®°å½•</text>
    </view>
  </view>

  <!-- æ¯æ—¥æ€»ç»“ -->
  <view class="summary-section">
    <view class="section-header">
      <text class="section-title">ğŸ“ ä»Šæ—¥æ€»ç»“</text>
      <text class="summary-hint" wx:if="{{!summary.content}}">ç‚¹å‡»è¾“å…¥</text>
    </view>
    <view class="summary-input" bindtap="editSummary">
      <textarea
        class="summary-textarea"
        placeholder="å†™ä¸‹ä»Šå¤©çš„æ”¶è·å’Œæ€è€ƒ..."
        value="{{summary.content}}"
        bindinput="onSummaryInput"
        bindblur="saveSummary"
        maxlength="500"
        auto-height
        cursor-spacing="20"
      />
      <view class="summary-char-count" wx:if="{{summary.content}}">
        <text>{{summary.content.length}}/500</text>
      </view>
    </view>
  </view>
</view>
