<!--pages/index/index.wxml-->
<view class="container">
  <!-- é¡¶éƒ¨æ—¶é—´æ˜¾ç¤º -->
  <view class="header">
    <text class="current-time">{{currentTime}}</text>
    <text class="current-date">{{currentDate}}</text>
  </view>

  <!-- ä»Šæ—¥å¾…åŠå¡ç‰‡ -->
  <view class="memo-card" wx:if="{{todayMemos.length > 0}}">
    <view class="memo-card-header" bindtap="toggleMemoCard">
      <view class="memo-card-title">
        <text class="memo-icon">ğŸ“</text>
        <text class="memo-title-text">ä»Šæ—¥å¾…åŠ</text>
        <text class="memo-count">({{todayMemos.length}})</text>
      </view>
      <view class="memo-card-action">
        <text class="action-text" catchtap="goToMemoList">æŸ¥çœ‹å…¨éƒ¨</text>
        <text class="expand-arrow {{memoCardExpanded ? 'expanded' : ''}}">â–¼</text>
      </view>
    </view>

    <!-- å±•å¼€çš„å¾…åŠåˆ—è¡¨ -->
    <view class="memo-card-content" wx:if="{{memoCardExpanded}}">
      <view
        class="memo-card-item {{item.isCompleted ? 'completed' : ''}}"
        wx:for="{{displayMemos}}"
        wx:key="_id"
        bindtap="goToMemoEdit"
        data-id="{{item._id}}"
      >
        <view class="memo-item-left">
          <view class="memo-item-time">{{item.reminderTimeStr}}</view>
          <view class="memo-item-title">{{item.title}}</view>
        </view>
        <view class="memo-item-right">
          <view
            class="memo-check-btn {{item.isCompleted ? 'checked' : ''}}"
            catchtap="quickComplete"
            data-id="{{item._id}}"
            data-completed="{{item.isCompleted}}"
          >
            <text class="check-icon">{{item.isCompleted ? 'âœ“' : ''}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- ä¸­å¤®å½•éŸ³æŒ‰é’®åŒºåŸŸ -->
  <view class="record-area">
    <view class="record-btn {{isRecording ? 'recording' : ''}}"
          bindtap="toggleRecord">
      <view class="mic-icon">ğŸ¤</view>
      <text class="record-text">{{recordText}}</text>
    </view>

    <!-- å½•éŸ³çŠ¶æ€æç¤º -->
    <view class="status-tip" wx:if="{{statusTip}}">
      <text>{{statusTip}}</text>
    </view>
  </view>

  <!-- æœ€è¿‘è®°å½• -->
  <view class="recent-records">
    <view class="section-title">
      <text>ğŸ“‹ æœ€è¿‘è®°å½•</text>
    </view>

    <view class="record-list">
      <view class="record-item"
            wx:for="{{recentRecords}}"
            wx:key="id"
            bindtap="viewDetail"
            data-id="{{item._id}}">
        <view class="record-time">
          <text>{{item.startTimeStr}} - {{item.endTimeStr}}</text>
        </view>
        <view class="record-content">
          <text>{{item.content}}</text>
        </view>
        <view class="record-tags">
          <text class="tag"
                wx:for="{{item.tags}}"
                wx:for-item="tag"
                wx:key="index"
                style="background-color: {{tag.color}}20; color: {{tag.color}}">
            {{tag.icon}} {{tag.name}}
          </text>
        </view>
      </view>

      <!-- ç©ºçŠ¶æ€ -->
      <view class="empty-state" wx:if="{{recentRecords.length === 0}}">
        <text>ğŸ¯ ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹è®°å½•</text>
      </view>
    </view>
  </view>
</view>
