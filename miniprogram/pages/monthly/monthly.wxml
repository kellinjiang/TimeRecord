<!--pages/monthly/monthly.wxml-->
<view class="container">
  <!-- é¡¶éƒ¨æœˆä»½å¯¼èˆª -->
  <view class="month-header">
    <view class="month-nav" bindtap="prevMonth">
      <text class="nav-arrow">â€¹</text>
    </view>
    <view class="month-picker">
      <text class="current-month">{{monthStr}}</text>
      <text class="year-label">{{yearStr}}</text>
    </view>
    <view class="month-nav" bindtap="nextMonth">
      <text class="nav-arrow">â€º</text>
    </view>
  </view>

  <!-- æœ¬æœˆç»Ÿè®¡å¡ç‰‡ -->
  <view class="stats-card">
    <view class="stats-title">ğŸ“Š æœ¬æœˆç»Ÿè®¡</view>
    <view class="stats-content">
      <view class="stat-item">
        <text class="stat-value">{{stats.totalRecords}}</text>
        <text class="stat-label">è®°å½•æ•°</text>
      </view>
      <view class="stat-divider"></view>
      <view class="stat-item">
        <text class="stat-value">{{stats.totalHours}}h</text>
        <text class="stat-label">æ€»æ—¶é•¿</text>
      </view>
      <view class="stat-divider"></view>
      <view class="stat-item">
        <text class="stat-value">{{stats.activeDays}}</text>
        <text class="stat-label">æ´»è·ƒå¤©æ•°</text>
      </view>
    </view>

    <!-- æ ‡ç­¾åˆ†å¸ƒæ¡å½¢å›¾ -->
    <view class="tags-distribution" wx:if="{{stats.tagStats.length > 0}}">
      <view
        class="tag-bar"
        wx:for="{{stats.tagStats}}"
        wx:key="name"
        style="width: {{item.percentage}}%; background-color: {{item.color}};"
      >
        <text class="tag-bar-label" wx:if="{{item.percentage > 8}}">{{item.icon}}</text>
      </view>
    </view>
  </view>

  <!-- æ—¥å†è§†å›¾ -->
  <view class="calendar-section">
    <view class="section-header">
      <text class="section-title">ğŸ“… æ—¥å†</text>
      <text class="calendar-hint">ç‚¹å‡»æ—¥æœŸæŸ¥çœ‹è¯¦æƒ…</text>
    </view>

    <view class="calendar">
      <!-- æ˜ŸæœŸæ ‡é¢˜ -->
      <view class="calendar-weekdays">
        <view class="weekday-label" wx:for="{{weekdayLabels}}" wx:key="*this">{{item}}</view>
      </view>

      <!-- æ—¥æœŸç½‘æ ¼ -->
      <view class="calendar-days">
        <view
          class="day-cell {{item.isCurrentMonth ? '' : 'other-month'}} {{item.isToday ? 'today' : ''}} {{item.hasRecords ? 'has-records' : ''}}"
          wx:for="{{calendarDays}}"
          wx:key="dateStr"
          bindtap="viewDay"
          data-date="{{item.dateStr}}"
        >
          <text class="day-number">{{item.day}}</text>
          <view class="day-indicator" wx:if="{{item.hasRecords}}">
            <text class="record-count">{{item.recordCount}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- å‘¨è¶‹åŠ¿å›¾ -->
  <view class="week-chart-section">
    <view class="section-header">
      <text class="section-title">ğŸ“ˆ å‘¨è¶‹åŠ¿</text>
      <text class="chart-unit">å°æ—¶</text>
    </view>

    <view class="week-chart" wx:if="{{weekStats.length > 0}}">
      <view class="week-bar-item" wx:for="{{weekStats}}" wx:key="weekNum">
        <view class="week-bar-container">
          <view
            class="week-bar-fill"
            style="height: {{item.percentage}}%; background-color: #1AAD19;"
          >
            <text class="week-bar-value" wx:if="{{item.hours > 0}}">{{item.hours}}h</text>
          </view>
        </view>
        <text class="week-bar-label">ç¬¬{{item.weekNum}}å‘¨</text>
        <text class="week-bar-date">{{item.dateRange}}</text>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-chart" wx:if="{{stats.totalRecords === 0}}">
      <text class="empty-icon">ğŸ“Š</text>
      <text class="empty-text">æœ¬æœˆè¿˜æ²¡æœ‰è®°å½•</text>
    </view>
  </view>

  <!-- æ ‡ç­¾è¯¦ç»†ç»Ÿè®¡ -->
  <view class="tags-section" wx:if="{{stats.tagStats.length > 0}}">
    <view class="section-header">
      <text class="section-title">ğŸ·ï¸ æ ‡ç­¾ç»Ÿè®¡</text>
      <text class="tags-count">{{stats.tagStats.length}} ä¸ªæ ‡ç­¾</text>
    </view>

    <view class="tag-list">
      <view
        class="tag-stat-item"
        wx:for="{{stats.tagStats}}"
        wx:key="name"
        wx:if="{{index < 5}}"
      >
        <view class="tag-info">
          <text class="tag-icon">{{item.icon}}</text>
          <text class="tag-name">{{item.name}}</text>
        </view>
        <view class="tag-data">
          <text class="tag-hours">{{item.hours}}h</text>
          <text class="tag-percentage">{{item.percentage}}%</text>
        </view>
        <view class="tag-bar-bg">
          <view
            class="tag-bar-fill"
            style="width: {{item.percentage}}%; background-color: {{item.color}};"
          ></view>
        </view>
      </view>
    </view>
  </view>

  <!-- æœˆæ€»ç»“ -->
  <view class="summary-section">
    <view class="section-header">
      <text class="section-title">ğŸ“ æœˆæ€»ç»“</text>
      <text class="summary-hint" wx:if="{{!summary.content}}">å†™ä¸‹æœ¬æœˆçš„æ”¶è·</text>
    </view>
    <view class="summary-input">
      <textarea
        class="summary-textarea"
        placeholder="å›é¡¾æœ¬æœˆçš„æ”¶è·å’Œæ€è€ƒ...&#10;&#10;æç¤ºï¼š&#10;â€¢ æœ¬æœˆå®Œæˆäº†å“ªäº›é‡è¦ç›®æ ‡ï¼Ÿ&#10;â€¢ æœ‰ä»€ä¹ˆç»éªŒå’Œæ•™è®­ï¼Ÿ&#10;â€¢ ä¸‹æœˆè®¡åˆ’æ˜¯ä»€ä¹ˆï¼Ÿ"
        value="{{summary.content}}"
        bindinput="onSummaryInput"
        bindblur="saveSummary"
        maxlength="1500"
        auto-height
        cursor-spacing="20"
      />
      <view class="summary-char-count" wx:if="{{summary.content}}">
        <text>{{summary.content.length}}/1500</text>
      </view>
    </view>
  </view>
</view>
