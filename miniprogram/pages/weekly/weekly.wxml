<!--pages/weekly/weekly.wxml-->
<view class="container">
  <!-- é¡¶éƒ¨å‘¨å¯¼èˆª -->
  <view class="week-header">
    <view class="week-nav" bindtap="prevWeek">
      <text class="nav-arrow">â€¹</text>
    </view>
    <picker mode="date" value="{{currentWeekStart}}" bindchange="onDateChange" class="week-picker-trigger">
      <view class="week-picker">
        <text class="week-range">{{weekRange}}</text>
        <text class="week-label">ç¬¬{{weekNumber}}å‘¨</text>
      </view>
    </picker>
    <view class="week-nav" bindtap="nextWeek">
      <text class="nav-arrow">â€º</text>
    </view>
  </view>

  <!-- æœ¬å‘¨ç»Ÿè®¡å¡ç‰‡ -->
  <view class="stats-card">
    <view class="stats-title">ğŸ“Š æœ¬å‘¨ç»Ÿè®¡</view>
    <view class="stats-content">
      <view class="stat-item">
        <text class="stat-value">{{stats.totalRecords}}</text>
        <text class="stat-label">è®°å½•æ•°</text>
      </view>
      <view class="stat-divider"></view>
      <view class="stat-item">
        <text class="stat-value">{{stats.totalHours}}h</text>
        <text class="stat-label">æ€»æ—¶é•¿</text>
      </view>
      <view class="stat-divider"></view>
      <view class="stat-item">
        <text class="stat-value">{{stats.avgHours}}h</text>
        <text class="stat-label">æ—¥å‡æ—¶é•¿</text>
      </view>
    </view>

    <!-- æ ‡ç­¾åˆ†å¸ƒ -->
    <view class="tags-distribution" wx:if="{{stats.tagStats.length > 0}}">
      <view
        class="tag-bar"
        wx:for="{{stats.tagStats}}"
        wx:key="name"
        style="width: {{item.percentage}}%; background-color: {{item.color}};"
      >
        <text class="tag-bar-label" wx:if="{{item.percentage > 10}}">{{item.icon}} {{item.name}}</text>
      </view>
    </view>
  </view>

  <!-- æ¯æ—¥æ—¶é•¿æŸ±çŠ¶å›¾ -->
  <view class="chart-section">
    <view class="section-header">
      <text class="section-title">ğŸ“ˆ æ¯æ—¥æ—¶é•¿</text>
      <text class="chart-unit">å°æ—¶</text>
    </view>

    <view class="bar-chart">
      <view
        class="bar-item"
        wx:for="{{weekDays}}"
        wx:key="date"
        bindtap="viewDay"
        data-date="{{item.date}}"
      >
        <view class="bar-container">
          <view
            class="bar-fill"
            style="height: {{item.percentage}}%; background-color: {{item.isToday ? '#1AAD19' : '#91d5ff'}};"
          >
            <text class="bar-value" wx:if="{{item.hours > 0}}">{{item.hours}}h</text>
          </view>
        </view>
        <text class="bar-label {{item.isToday ? 'today' : ''}}">{{item.dayLabel}}</text>
        <text class="bar-date">{{item.dateLabel}}</text>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-chart" wx:if="{{stats.totalRecords === 0}}">
      <text class="empty-icon">ğŸ“Š</text>
      <text class="empty-text">æœ¬å‘¨è¿˜æ²¡æœ‰è®°å½•</text>
    </view>
  </view>

  <!-- æ ‡ç­¾è¯¦ç»†ç»Ÿè®¡ -->
  <view class="tags-section" wx:if="{{stats.tagStats.length > 0}}">
    <view class="section-header">
      <text class="section-title">ğŸ·ï¸ æ ‡ç­¾ç»Ÿè®¡</text>
      <text class="tags-count">{{stats.tagStats.length}} ä¸ªæ ‡ç­¾</text>
    </view>

    <view class="tag-list">
      <view
        class="tag-stat-item"
        wx:for="{{stats.tagStats}}"
        wx:key="name"
      >
        <view class="tag-info">
          <text class="tag-icon">{{item.icon}}</text>
          <text class="tag-name">{{item.name}}</text>
        </view>
        <view class="tag-data">
          <text class="tag-hours">{{item.hours}}h</text>
          <text class="tag-percentage">{{item.percentage}}%</text>
        </view>
        <view class="tag-bar-bg">
          <view
            class="tag-bar-fill"
            style="width: {{item.percentage}}%; background-color: {{item.color}};"
          ></view>
        </view>
      </view>
    </view>
  </view>

  <!-- å‘¨æ€»ç»“ -->
  <view class="summary-section">
    <view class="section-header">
      <text class="section-title">ğŸ“ å‘¨æ€»ç»“</text>
      <text class="summary-hint" wx:if="{{!summary.content}}">ç‚¹å‡»è¾“å…¥</text>
    </view>
    <view class="summary-input">
      <textarea
        class="summary-textarea"
        placeholder="{{summaryPlaceholder}}"
        value="{{summary.content}}"
        bindinput="onSummaryInput"
        bindblur="saveSummary"
        maxlength="1000"
        auto-height
        cursor-spacing="20"
      />
      <view class="summary-char-count" wx:if="{{summary.content}}">
        <text>{{summary.content.length}}/1000</text>
      </view>
    </view>
  </view>
</view>
