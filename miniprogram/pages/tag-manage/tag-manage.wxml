<!--æ ‡ç­¾ç®¡ç†é¡µé¢-->
<view class="container">

  <!-- é¡µé¢è¯´æ˜ -->
  <view class="page-tip">
    <text class="tip-icon">ğŸ’¡</text>
    <text class="tip-text">ç®¡ç†æ‚¨çš„æ ‡ç­¾ï¼Œè‡ªå®šä¹‰æ ‡ç­¾å¯ä»¥ç¼–è¾‘å’Œåˆ é™¤</text>
  </view>

  <!-- é»˜è®¤æ ‡ç­¾åŒºåŸŸ -->
  <view class="section">
    <view class="section-header">
      <text class="section-title">é»˜è®¤æ ‡ç­¾</text>
      <text class="section-subtitle">ç³»ç»Ÿå†…ç½®ï¼Œä¸å¯ç¼–è¾‘</text>
    </view>

    <view class="tag-list">
      <view class="tag-item" wx:for="{{defaultTags}}" wx:key="name">
        <view class="tag-icon" style="background-color: {{item.color}};">
          <text>{{item.icon}}</text>
        </view>
        <view class="tag-info">
          <text class="tag-name">{{item.name}}</text>
          <text class="tag-usage">ä½¿ç”¨ {{item.usageCount || 0}} æ¬¡</text>
        </view>
        <view class="tag-badge">
          <text>é»˜è®¤</text>
        </view>
      </view>
    </view>
  </view>

  <!-- è‡ªå®šä¹‰æ ‡ç­¾åŒºåŸŸ -->
  <view class="section">
    <view class="section-header">
      <view class="header-left">
        <text class="section-title">è‡ªå®šä¹‰æ ‡ç­¾</text>
        <text class="section-subtitle">{{customTags.length}} ä¸ª</text>
      </view>
      <view class="add-btn" bindtap="showAddDialog">
        <text class="add-icon">+</text>
        <text class="add-text">æ·»åŠ </text>
      </view>
    </view>

    <!-- è‡ªå®šä¹‰æ ‡ç­¾åˆ—è¡¨ -->
    <view class="tag-list" wx:if="{{customTags.length > 0}}">
      <view class="tag-item" wx:for="{{customTags}}" wx:key="_id">
        <view class="tag-icon" style="background-color: {{item.color}};">
          <text>{{item.icon}}</text>
        </view>
        <view class="tag-info">
          <text class="tag-name">{{item.name}}</text>
          <text class="tag-usage">ä½¿ç”¨ {{item.usageCount || 0}} æ¬¡</text>
        </view>
        <view class="tag-actions">
          <view class="action-btn edit-btn" bindtap="editTag" data-tag="{{item}}">
            <text>ç¼–è¾‘</text>
          </view>
          <view class="action-btn delete-btn" bindtap="deleteTag" data-id="{{item._id}}" data-name="{{item.name}}">
            <text>åˆ é™¤</text>
          </view>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{customTags.length === 0}}">
      <text class="empty-icon">ğŸ·ï¸</text>
      <text class="empty-text">è¿˜æ²¡æœ‰è‡ªå®šä¹‰æ ‡ç­¾</text>
      <text class="empty-tip">ç‚¹å‡»å³ä¸Šè§’"æ·»åŠ "æŒ‰é’®åˆ›å»º</text>
    </view>
  </view>

  <!-- æ·»åŠ /ç¼–è¾‘æ ‡ç­¾å¼¹çª— -->
  <view class="modal-mask" wx:if="{{showDialog}}" bindtap="hideDialog" catchtouchmove="preventMove">
    <view class="modal-dialog" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">{{isEditMode ? 'ç¼–è¾‘æ ‡ç­¾' : 'æ·»åŠ æ ‡ç­¾'}}</text>
        <view class="close-btn" bindtap="hideDialog">
          <text>âœ•</text>
        </view>
      </view>

      <view class="modal-body">
        <!-- æ ‡ç­¾åç§° -->
        <view class="form-item">
          <text class="form-label">æ ‡ç­¾åç§°</text>
          <input
            class="form-input"
            placeholder="è¯·è¾“å…¥æ ‡ç­¾åç§°"
            value="{{formData.name}}"
            bindinput="onNameInput"
            maxlength="10"
          />
          <text class="char-count">{{formData.name.length}}/10</text>
        </view>

        <!-- é€‰æ‹©å›¾æ ‡ -->
        <view class="form-item">
          <text class="form-label">é€‰æ‹©å›¾æ ‡</text>
          <view class="icon-grid">
            <view
              class="icon-item {{formData.icon === item ? 'active' : ''}}"
              wx:for="{{iconOptions}}"
              wx:key="*this"
              bindtap="selectIcon"
              data-icon="{{item}}"
            >
              <text>{{item}}</text>
            </view>
          </view>
        </view>

        <!-- é€‰æ‹©é¢œè‰² -->
        <view class="form-item">
          <text class="form-label">é€‰æ‹©é¢œè‰²</text>
          <view class="color-grid">
            <view
              class="color-item {{formData.color === item ? 'active' : ''}}"
              wx:for="{{colorOptions}}"
              wx:key="*this"
              style="background-color: {{item}};"
              bindtap="selectColor"
              data-color="{{item}}"
            >
              <text class="check-icon" wx:if="{{formData.color === item}}">âœ“</text>
            </view>
          </view>
        </view>

        <!-- é¢„è§ˆ -->
        <view class="form-item">
          <text class="form-label">é¢„è§ˆæ•ˆæœ</text>
          <view class="tag-preview">
            <view class="preview-tag" style="background-color: {{formData.color}};">
              <text class="preview-icon">{{formData.icon}}</text>
              <text class="preview-name">{{formData.name || 'æ ‡ç­¾åç§°'}}</text>
            </view>
          </view>
        </view>
      </view>

      <view class="modal-footer">
        <view class="modal-btn cancel-btn" bindtap="hideDialog">
          <text>å–æ¶ˆ</text>
        </view>
        <view class="modal-btn confirm-btn" bindtap="saveTag">
          <text>{{isEditMode ? 'ä¿å­˜' : 'æ·»åŠ '}}</text>
        </view>
      </view>
    </view>
  </view>

</view>
