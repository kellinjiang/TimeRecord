# 📐 时间管理语音日志小程序 - 技术设计方案

> 文档版本：v1.0
> 创建日期：2025-10-30
> 技术选型：微信小程序 + 云开发

---

## 目录

- [一、系统架构设计](#一系统架构设计)
- [二、数据库结构设计](#二数据库结构设计)
- [三、页面结构与交互流程设计](#三页面结构与交互流程设计)
- [四、云函数模块设计](#四云函数模块设计)
- [五、分阶段开发计划](#五分阶段开发计划)
- [六、技术实施要点](#六技术实施要点)
- [七、风险评估与应对](#七风险评估与应对)
- [八、下一步行动清单](#八下一步行动清单)

---

## 一、系统架构设计

### 1.1 整体架构图

```
┌─────────────────────────────────────────────────────────────┐
│                      微信小程序前端层                          │
├─────────────────────────────────────────────────────────────┤
│  录音页  │  日志处理页  │  日视图  │  周视图  │  月视图  │  设置页  │
└─────────────────────────────────────────────────────────────┘
                              ↓ ↑
┌─────────────────────────────────────────────────────────────┐
│                        云开发服务层                            │
├─────────────────────────────────────────────────────────────┤
│  云函数          │  云数据库        │  云存储        │  云调用   │
│  ----------------│-----------------│---------------│---------- │
│  • recordSave   │  • records      │  • 语音文件   │  • ASR API │
│  • recordUpdate │  • tags         │  • 导出文件   │  • 订阅消息 │
│  • getTimeline  │  • summaries    │               │           │
│  • getStats     │  • users        │               │           │
│  • exportData   │  • templates    │               │           │
└─────────────────────────────────────────────────────────────┘
                              ↓ ↑
┌─────────────────────────────────────────────────────────────┐
│                      第三方服务集成                            │
├─────────────────────────────────────────────────────────────┤
│  • 微信语音识别插件                                             │
│  • ECharts 图表库                                              │
└─────────────────────────────────────────────────────────────┘
```

### 1.2 数据流设计

```
用户录音 → 语音识别 → 文本展示 → 用户编辑/标签 → 云数据库存储
                                                      ↓
                    日志列表查询 ← 云函数计算时间段 ← 数据库
                         ↓
                    可视化统计 ← 云函数聚合数据 ← 数据库
```

### 1.3 技术栈总结

| 层级 | 技术选型 | 学习难度 | 开发周期 |
|-----|---------|---------|---------|
| **前端** | 微信小程序原生 | ⭐⭐ | 2-3 周 |
| **后端** | 微信云开发 | ⭐ | 1 周 |
| **数据库** | 云开发数据库 | ⭐ | 3 天 |
| **语音识别** | 微信官方 API | ⭐ | 2 天 |
| **图表** | ECharts | ⭐⭐ | 3 天 |

---

## 二、数据库结构设计

### 2.1 云数据库集合概览

| 集合名称 | 说明 | 主要字段 |
|---------|------|---------|
| `records` | 日志记录表 | startTime, endTime, content, tags |
| `tags` | 用户标签表 | name, color, icon, usageCount |
| `summaries` | 总结表 | type, date, content, stats |
| `users` | 用户配置表 | settings, usageStats |
| `templates` | 情景模板表 | name, content, tags |

---

### 2.2 详细集合设计

#### 📦 集合 1：`records` - 日志记录表

```javascript
{
  _id: "auto_generated_id",           // 自动生成主键
  _openid: "user_openid",             // 用户标识（云开发自动注入）

  // 时间相关
  startTime: Date,                    // 开始时间（ISODate格式）
  endTime: Date,                      // 结束时间（可为null，待下次记录生成）
  duration: Number,                   // 持续时长（分钟），自动计算

  // 内容相关
  content: String,                    // 日志文本内容
  audioFileId: String,                // 语音文件ID（云存储路径，可选）
  audioUrl: String,                   // 临时音频URL（可选）

  // 分类标签
  tags: Array,                        // 标签数组 ["工作", "文档"]

  // 地理位置（可选扩展）
  location: {
    latitude: Number,
    longitude: Number,
    name: String                      // 地点名称
  },

  // 元数据
  createTime: Date,                   // 创建时间
  updateTime: Date,                   // 最后更新时间
  isDeleted: Boolean,                 // 软删除标记
  source: String                      // 来源：voice/manual/template
}
```

**索引设计：**
```javascript
// 复合索引：用户+开始时间（支持日志列表查询）
{ _openid: 1, startTime: -1 }

// 单字段索引：结束时间（支持空白时间段检测）
{ endTime: 1 }
```

---

#### 🏷️ 集合 2：`tags` - 用户标签表

```javascript
{
  _id: "auto_generated_id",
  _openid: "user_openid",

  name: String,                       // 标签名称："工作"
  color: String,                      // 颜色代码："#FF5733"
  icon: String,                       // emoji图标："💼"
  sortOrder: Number,                  // 排序权重

  usageCount: Number,                 // 使用次数（用于推荐）
  isSystem: Boolean,                  // 是否系统预设标签

  createTime: Date,
  updateTime: Date,
  isDeleted: Boolean
}
```

**索引设计：**
```javascript
{ _openid: 1, sortOrder: 1 }
```

---

#### 📝 集合 3：`summaries` - 总结表

```javascript
{
  _id: "auto_generated_id",
  _openid: "user_openid",

  type: String,                       // 类型：daily/weekly/monthly
  date: String,                       // 日期标识："2025-10-29" / "2025-W44" / "2025-10"

  content: String,                    // 总结内容

  // 统计数据（自动生成）
  stats: {
    totalRecords: Number,             // 记录条数
    totalDuration: Number,            // 总时长（分钟）
    tagDistribution: Object           // 标签分布 { "工作": 480, "学习": 120 }
  },

  createTime: Date,
  updateTime: Date
}
```

**索引设计：**
```javascript
{ _openid: 1, type: 1, date: -1 }
```

---

#### 👤 集合 4：`users` - 用户配置表

```javascript
{
  _id: "auto_generated_id",
  _openid: "user_openid",

  // 用户基础信息
  nickName: String,
  avatarUrl: String,

  // 配置项
  settings: {
    blankTimeThreshold: Number,       // 空白时间阈值（小时），默认3
    dailyReminderTime: String,        // 每日提醒时间："21:00"
    enableReminder: Boolean,          // 是否启用提醒
    defaultTags: Array                // 默认常用标签
  },

  // 使用统计
  usageStats: {
    totalRecords: Number,
    totalDays: Number,
    lastActiveDate: String
  },

  registerTime: Date,
  lastLoginTime: Date
}
```

**索引设计：**
```javascript
{ _openid: 1 }
```

---

#### 📋 集合 5：`templates` - 情景模板表

```javascript
{
  _id: "auto_generated_id",
  _openid: "user_openid",

  name: String,                       // 模板名称："早晨通勤"
  content: String,                    // 预设内容："地铁上听播客"
  tags: Array,                        // 默认标签：["通勤"]

  usageCount: Number,
  sortOrder: Number,

  createTime: Date,
  isDeleted: Boolean
}
```

---

## 三、页面结构与交互流程设计

### 3.1 小程序页面架构

```
miniprogram/
├── pages/
│   ├── index/              # 首页/录音页（主页）
│   ├── record-edit/        # 日志编辑页
│   ├── daily/              # 日视图页
│   ├── weekly/             # 周视图页
│   ├── monthly/            # 月视图页
│   ├── settings/           # 设置页
│   └── template/           # 模板管理页
└── components/
    ├── record-item/        # 日志记录组件
    ├── tag-selector/       # 标签选择器组件
    ├── time-picker/        # 时间选择器组件
    ├── chart-view/         # 图表展示组件
    └── timeline/           # 时间轴组件
```

---

### 3.2 页面详细设计

#### 📱 页面 1：首页（录音页）`pages/index/index`

**功能定位：** 核心操作页面，提供快速录音入口

**页面结构：**
```
┌─────────────────────────────┐
│  ⏰ 2025-10-29 14:30       │  顶部：当前时间
├─────────────────────────────┤
│                             │
│                             │
│        [  🎤  ]            │  中央：超大录音按钮
│       按住录音              │  状态：未录制/录制中/识别中
│                             │
│                             │
├─────────────────────────────┤
│ 📋 最近记录                 │  底部：最近3条记录快速预览
│ • 13:00-14:30 处理文档      │  点击跳转到日视图
│ • 11:00-12:00 团队会议      │
│ • 09:00-11:00 代码开发      │
└─────────────────────────────┘
│  [日志] [统计] [我的]       │  底部导航栏
└─────────────────────────────┘
```

**交互流程：**
1. 点击录音按钮 → 开始录音
2. 录音中显示波形动画
3. 再次点击停止 → 调用 ASR 识别
4. 识别成功 → 跳转到编辑页
5. 识别失败 → 提示重试

---

#### ✏️ 页面 2：日志编辑页 `pages/record-edit/record-edit`

**页面结构：**
```
┌─────────────────────────────┐
│  ← 返回        保存          │  导航栏
├─────────────────────────────┤
│ 开始时间                     │
│ [14:30] 📅                  │  时间选择器
│                             │
│ 内容                         │
│ ┌─────────────────────────┐ │
│ │处理项目文档，整理需求...  │ │  多行文本输入框
│ │                         │ │
│ └─────────────────────────┘ │
│                             │
│ 快速标签                     │
│ [💼工作] [📄文档] [🏠家庭]  │  标签快选（可配置）
│ [✏️更多标签...]              │
│                             │
│ 常用模板                     │
│ [🚇通勤] [☕休息] [📖学习]  │  模板快选
└─────────────────────────────┘
```

**关键逻辑：**
- 自动填充 ASR 识别结果
- 自动记录当前时间为 `startTime`
- 保存时自动更新上一条记录的 `endTime`

---

#### 📅 页面 3：日视图页 `pages/daily/daily`

**页面结构：**
```
┌─────────────────────────────┐
│ ← 2025-10-28  今天  10-30 →│  日期切换
├─────────────────────────────┤
│ 📊 今日统计                  │
│ 工作 8h | 学习 2h | 休息 1h │  顶部统计卡片
├─────────────────────────────┤
│ ⏰ 时间轴                    │
│                             │
│ 09:00 ━━━━━━━━┓            │
│               ┃ 💼 工作     │  记录卡片（可展开）
│               ┃ 代码开发    │
│ 11:00 ━━━━━━━━┛  [编辑]   │
│                             │
│ 11:00 ━━━━━━━━┓            │
│               ┃ ☕ 休息     │
│ 12:00 ━━━━━━━━┛            │
│                             │
│ 12:00 ~ 13:00               │
│ ⚠️ 空白时间段 [补录]        │  空白提示
│                             │
│ 13:00 ━━━━━━━━┓            │
│               ┃ 💼 工作     │
│ 14:30 ━━━━━━━━┛            │
├─────────────────────────────┤
│ 📝 今日总结                  │
│ [点击输入总结...]            │  展开式输入框
└─────────────────────────────┘
```

**交互要点：**
- 左右滑动切换日期
- 长按记录项支持删除
- 点击"补录"弹出表单

---

#### 📈 页面 4：周视图页 `pages/weekly/weekly`

**页面结构：**
```
┌─────────────────────────────┐
│ ← 第 44 周  本周  第 46 周 →│
├─────────────────────────────┤
│ 📊 本周总时长：45小时        │
│                             │
│ [饼图：标签分布]             │  ECharts 饼图
│ 工作 60%                    │
│ 学习 25%                    │
│ 其他 15%                    │
├─────────────────────────────┤
│ 每日汇总                     │
│ 周一 10-28  8h [查看]       │  可点击跳转日视图
│ 周二 10-29  9h [查看]       │
│ 周三 10-30  7h [查看]       │
│ ...                         │
├─────────────────────────────┤
│ 📝 周总结                    │
│ [点击输入周总结...]          │
└─────────────────────────────┘
```

---

#### 📊 页面 5：月视图页 `pages/monthly/monthly`

**页面结构：**
```
┌─────────────────────────────┐
│ ← 2025年9月  本月  11月 →   │
├─────────────────────────────┤
│ 📊 本月总时长：180小时       │
│                             │
│ [柱状图：周趋势]             │  ECharts 柱状图
│                             │
├─────────────────────────────┤
│ 日历视图                     │
│ 一 二 三 四 五 六 日         │
│       1  2  3  4  5  6      │
│ 7  8  9 10 11 12 13         │  点击日期跳转日视图
│ ...                         │
├─────────────────────────────┤
│ 📝 月总结                    │
│ [点击输入月总结...]          │
└─────────────────────────────┘
```

---

#### ⚙️ 页面 6：设置页 `pages/settings/settings`

**页面结构：**
```
┌─────────────────────────────┐
│ 设置                         │
├─────────────────────────────┤
│ 基础设置                     │
│ > 标签管理                   │
│ > 模板管理                   │
│ > 空白时间阈值 (3小时)       │
├─────────────────────────────┤
│ 提醒设置                     │
│ > 每日复盘提醒 (21:00)       │
│ > 开启推送通知 [✓]          │
├─────────────────────────────┤
│ 数据管理                     │
│ > 导出数据                   │
│ > 云同步状态                 │
├─────────────────────────────┤
│ 关于                         │
│ 版本号：v1.0.0              │
└─────────────────────────────┘
```

---

## 四、云函数模块设计

### 4.1 云函数架构

```
cloudfunctions/
├── recordSave/           # 保存日志记录
├── recordUpdate/         # 更新日志记录
├── recordDelete/         # 删除日志记录
├── getTimeline/          # 获取时间轴数据
├── getStats/             # 获取统计数据
├── saveSummary/          # 保存总结
├── exportData/           # 导出数据
├── syncTags/             # 同步标签配置
└── checkBlankTime/       # 检测空白时间段
```

---

### 4.2 核心云函数详细设计

#### ☁️ 云函数 1：`recordSave` - 保存日志记录

**输入参数：**
```javascript
{
  content: String,        // 日志内容
  startTime: Date,        // 开始时间
  tags: Array,           // 标签数组
  audioFileId: String,   // 音频文件ID（可选）
  source: String         // 来源：voice/manual/template
}
```

**核心逻辑：**
```javascript
1. 获取用户最后一条记录
2. 如果存在且 endTime 为 null：
   - 将该记录的 endTime 设为当前 startTime
   - 计算 duration = (endTime - startTime) / 60000
3. 插入新记录到 records 集合
4. 更新 tags 集合的 usageCount
5. 返回新记录 ID
```

**返回数据：**
```javascript
{
  code: 0,
  message: "保存成功",
  data: {
    recordId: "xxx",
    previousRecord: { /* 更新后的上一条记录 */ }
  }
}
```

---

#### ☁️ 云函数 2：`getTimeline` - 获取时间轴数据

**输入参数：**
```javascript
{
  date: String,          // 日期："2025-10-29"
  type: String           // 类型：day/week/month
}
```

**核心逻辑：**
```javascript
// 日视图
1. 根据 date 查询当天所有记录
2. 检测空白时间段（间隔 > 3小时）
3. 计算标签统计
4. 查询当日总结

// 周视图/月视图
1. 查询时间范围内的所有记录
2. 按日期分组聚合
3. 计算标签时长分布
4. 查询周/月总结
```

**返回数据（日视图）：**
```javascript
{
  code: 0,
  data: {
    records: [
      {
        _id: "xxx",
        startTime: "2025-10-29T09:00:00.000Z",
        endTime: "2025-10-29T11:00:00.000Z",
        duration: 120,
        content: "代码开发",
        tags: ["工作", "编程"]
      }
    ],
    blankPeriods: [
      {
        start: "2025-10-29T12:00:00.000Z",
        end: "2025-10-29T13:00:00.000Z",
        duration: 60
      }
    ],
    stats: {
      totalDuration: 480,
      tagDistribution: {
        "工作": 360,
        "学习": 120
      }
    },
    summary: {
      content: "今日完成了..."
    }
  }
}
```

---

#### ☁️ 云函数 3：`getStats` - 获取统计数据

**输入参数：**
```javascript
{
  startDate: String,     // 开始日期
  endDate: String,       // 结束日期
  groupBy: String        // 分组维度：day/week/tag
}
```

**核心逻辑：**
```javascript
// 使用聚合管道
db.collection('records').aggregate()
  .match({ startTime: { $gte: startDate, $lte: endDate } })
  .group({
    _id: groupBy === 'tag' ? '$tags' : '$date',
    totalDuration: $.sum('$duration'),
    count: $.sum(1)
  })
  .sort({ totalDuration: -1 })
```

**返回数据：**
```javascript
{
  code: 0,
  data: {
    chartData: [
      { name: "工作", value: 360 },
      { name: "学习", value: 120 }
    ],
    total: 480
  }
}
```

---

#### ☁️ 云函数 4：`exportData` - 导出数据

**输入参数：**
```javascript
{
  startDate: String,
  endDate: String,
  format: String,        // txt/csv
  tags: Array           // 标签筛选（可选）
}
```

**核心逻辑：**
```javascript
1. 查询符合条件的记录
2. 根据 format 格式化数据：
   - CSV: 转换为 "开始时间,结束时间,内容,标签\n" 格式
   - TXT: 转换为 "09:00-11:00 [工作] 代码开发\n" 格式
3. 上传到云存储
4. 返回临时下载链接
```

**返回数据：**
```javascript
{
  code: 0,
  data: {
    fileUrl: "cloud://xxx.csv",
    tempUrl: "https://xxx",
    expireTime: 3600
  }
}
```

---

#### ☁️ 云函数 5：`checkBlankTime` - 检测空白时间段

**输入参数：**
```javascript
{
  date: String          // 日期："2025-10-29"
}
```

**核心逻辑：**
```javascript
1. 查询当天所有记录，按 startTime 排序
2. 遍历相邻记录，计算间隔
3. 如果间隔 > 阈值（默认3小时），标记为空白
4. 返回空白时间段列表
```

---

### 4.3 云函数调用示例

**前端调用方式：**
```javascript
// 保存记录
wx.cloud.callFunction({
  name: 'recordSave',
  data: {
    content: '处理项目文档',
    startTime: new Date(),
    tags: ['工作', '文档']
  }
}).then(res => {
  console.log('保存成功', res.result)
})

// 获取日志列表
wx.cloud.callFunction({
  name: 'getTimeline',
  data: {
    date: '2025-10-29',
    type: 'day'
  }
}).then(res => {
  this.setData({ records: res.result.data.records })
})
```

---

## 五、分阶段开发计划

### 5.1 开发阶段划分

采用**敏捷开发**模式，分为 **MVP 版本 → 功能完善 → 优化打磨** 三个阶段。

---

### 📦 第一阶段：MVP 最小可行产品（2周）

**目标：** 实现核心功能，验证产品可行性

#### 周 1：基础搭建 + 录音功能

| 任务 | 工作内容 | 预计时间 |
|-----|---------|---------|
| **项目初始化** | • 创建云开发小程序项目<br>• 配置云开发环境<br>• 搭建目录结构 | 1天 |
| **录音功能** | • 实现录音页面UI<br>• 集成微信录音API<br>• 接入语音识别插件 | 2天 |
| **日志编辑** | • 创建编辑页面<br>• 实现文本编辑<br>• 标签选择器组件 | 2天 |
| **数据库设计** | • 创建 records 集合<br>• 创建 tags 集合<br>• 实现 recordSave 云函数 | 2天 |

**交付物：**
- ✅ 能录音并识别成文字
- ✅ 能保存日志到云数据库
- ✅ 基础的标签功能

---

#### 周 2：日志查看 + 时间计算

| 任务 | 工作内容 | 预计时间 |
|-----|---------|---------|
| **日视图页面** | • 实现时间轴UI<br>• 展示日志列表<br>• 时间段自动计算逻辑 | 3天 |
| **云函数开发** | • getTimeline 云函数<br>• recordUpdate 云函数<br>• 时间段计算算法 | 2天 |
| **基础统计** | • 当日总时长统计<br>• 标签分类统计 | 2天 |

**交付物：**
- ✅ 完整的 "录音 → 识别 → 保存 → 查看" 闭环
- ✅ 时间段自动计算功能
- ✅ 基础数据统计

**里程碑：MVP 版本可演示**

---

### 📈 第二阶段：功能完善（2周）

**目标：** 补充周视图、月视图、数据可视化

#### 周 3：周/月视图 + 数据可视化

| 任务 | 工作内容 | 预计时间 |
|-----|---------|---------|
| **周视图** | • 页面布局<br>• 数据聚合展示<br>• 周总结输入 | 2天 |
| **月视图** | • 页面布局<br>• 月度数据展示<br>• 月总结输入 | 1天 |
| **图表集成** | • 集成 ECharts<br>• 实现饼图（标签分布）<br>• 实现柱状图（时间趋势） | 2天 |
| **总结功能** | • summaries 集合设计<br>• saveSummary 云函数<br>• 总结的增删改查 | 2天 |

---

#### 周 4：高级功能开发

| 任务 | 工作内容 | 预计时间 |
|-----|---------|---------|
| **空白检测** | • checkBlankTime 云函数<br>• 空白提示UI<br>• 补录功能 | 2天 |
| **模板功能** | • templates 集合<br>• 模板管理页面<br>• 快速填充逻辑 | 2天 |
| **标签管理** | • 标签增删改<br>• 标签排序<br>• 标签使用统计 | 1天 |
| **数据导出** | • exportData 云函数<br>• CSV/TXT 格式化<br>• 文件下载功能 | 2天 |

**交付物：**
- ✅ 完整的日/周/月三级视图
- ✅ 可视化图表展示
- ✅ 空白检测、模板、导出等辅助功能

---

### ✨ 第三阶段：优化打磨（1-2周）

**目标：** 性能优化、体验提升、上线准备

#### 周 5-6：优化与上线

| 任务 | 工作内容 | 预计时间 |
|-----|---------|---------|
| **性能优化** | • 云函数性能调优<br>• 数据库索引优化<br>• 页面加载优化 | 2天 |
| **UI/UX 优化** | • 交互细节打磨<br>• 加载动画<br>• 错误提示优化 | 2天 |
| **提醒功能** | • 订阅消息配置<br>• 定时提醒逻辑 | 1天 |
| **新手引导** | • 首次使用引导<br>• 功能说明页 | 1天 |
| **测试与修复** | • 功能测试<br>• Bug 修复<br>• 兼容性测试 | 2天 |
| **上线准备** | • 隐私协议<br>• 小程序审核材料<br>• 提交审核 | 1天 |

**交付物：**
- ✅ 功能完整、体验流畅的正式版本
- ✅ 通过微信审核，正式上线

---

### 5.2 开发时间线

```
阶段一：MVP（第1-2周）
  周1 |████████| 基础搭建+录音
  周2 |████████| 日志查看

阶段二：功能完善（第3-4周）
  周3 |████████| 周月视图+图表
  周4 |████████| 高级功能

阶段三：优化上线（第5-6周）
  周5 |████████| 优化打磨
  周6 |████| 测试上线
```

**总计：6周（42天）**
如果每天投入 2-3 小时，可在 **8-10 周**内完成。

---

### 5.3 开发优先级（MoSCoW 法则）

| 优先级 | 功能模块 | 说明 |
|-------|---------|-----|
| **Must Have<br>必须有** | • 录音与识别<br>• 日志保存<br>• 日视图<br>• 时间段计算 | 核心功能，第一阶段完成 |
| **Should Have<br>应该有** | • 周/月视图<br>• 数据可视化<br>• 空白检测<br>• 数据导出 | 重要功能，第二阶段完成 |
| **Could Have<br>可以有** | • 模板功能<br>• 地理定位<br>• 提醒功能 | 增强功能，第三阶段完成 |
| **Won't Have<br>暂不考虑** | • 多人协作<br>• AI 分析<br>• 数据分享 | 未来版本迭代 |

---

## 六、技术实施要点

### 6.1 关键技术难点与解决方案

| 难点 | 解决方案 |
|-----|---------|
| **时间段自动计算** | 每次保存时，云函数查询上一条记录并更新其 endTime |
| **空白时间检测** | 定时云函数或页面加载时触发检测逻辑 |
| **ASR 识别准确率** | 使用微信官方插件，提供手动编辑入口 |
| **图表渲染性能** | ECharts 按需加载，数据量过大时分页展示 |
| **数据导出** | 云函数生成文件，上传到云存储，返回临时链接 |

---

### 6.2 开发环境要求

```
✅ 微信开发者工具（最新版）
✅ Node.js 12+ （云函数开发）
✅ 微信开发者账号
✅ 已开通云开发服务
```

---

### 6.3 依赖库清单

```json
{
  "dependencies": {
    "echarts": "^5.4.0",           // 图表库
    "ec-canvas": "^1.0.0",         // 小程序 ECharts 适配
    "moment": "^2.29.0"            // 时间处理（可选）
  }
}
```

---

### 6.4 成本估算

| 项目 | 免费额度 | 超出后费用 |
|-----|---------|-----------|
| **云函数调用** | 10万次/月 | 0.0133元/千次 |
| **云数据库** | 2GB 存储 | 0.07元/GB/天 |
| **云存储** | 5GB | 0.004元/GB/天 |
| **语音识别** | 微信官方免费 | - |

**结论：** 前期（用户 < 500）完全免费，后期成本极低。

---

### 6.5 关键技术参数

| 指标 | 设计值 |
|-----|-------|
| 冷启动时间 | < 3秒 |
| ASR 识别延迟 | < 3秒 |
| 数据加载时间 | < 2秒 |
| 支持标签数量 | 10+ 自定义 |
| 数据导出格式 | TXT / CSV |
| 数据库集合数 | 5个 |
| 云函数数量 | 9个 |
| 页面总数 | 6个 |

---

## 七、风险评估与应对

### 7.1 技术风险

| 风险 | 影响 | 概率 | 应对措施 |
|-----|------|------|---------|
| **ASR 识别不准确** | 中 | 中 | 提供手动编辑入口，优化提示词 |
| **云开发配额不足** | 低 | 低 | 监控用量，提前升级套餐 |
| **数据库性能瓶颈** | 中 | 低 | 优化索引，数据分表存储 |
| **小程序审核不通过** | 高 | 中 | 提前准备隐私协议，避免敏感功能 |

---

### 7.2 项目风险

| 风险 | 应对措施 |
|-----|---------|
| **开发周期延期** | 采用 MVP 模式，先上线核心功能 |
| **用户体验不佳** | 多轮用户测试，快速迭代 |
| **功能复杂度膨胀** | 严格遵循开发计划，控制功能范围 |

---

## 八、下一步行动清单

### ✅ 即刻开始（本周）

#### 1. 注册微信小程序账号
- 前往 [微信公众平台](https://mp.weixin.qq.com/) 注册
- 完成主体认证（个人/企业）

#### 2. 安装开发工具
- 下载 [微信开发者工具](https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html)
- 安装 Node.js（用于云函数开发）

#### 3. 创建云开发项目
```bash
# 打开微信开发者工具
# 新建项目 → 选择"云开发快速启动模板"
# 开通云开发环境
```

#### 4. 学习基础知识
- 阅读微信小程序官方文档（1-2天）
- 完成云开发快速入门教程（1天）

---

### 📋 第一周详细任务

#### Day 1-2：项目搭建
- [ ] 创建小程序项目
- [ ] 初始化云开发环境
- [ ] 创建基础目录结构
- [ ] 配置 app.json 导航栏

#### Day 3-4：录音功能
- [ ] 设计录音页面 UI
- [ ] 接入微信录音 API
- [ ] 申请并集成语音识别插件
- [ ] 测试录音与识别流程

#### Day 5-7：数据保存
- [ ] 创建云数据库集合
- [ ] 开发 recordSave 云函数
- [ ] 实现日志编辑页面
- [ ] 测试数据保存功能

---

## 九、学习资源推荐

### 📚 必读文档

1. **微信小程序官方文档**
   https://developers.weixin.qq.com/miniprogram/dev/framework/

2. **云开发快速入门**
   https://developers.weixin.qq.com/miniprogram/dev/wxcloud/basis/getting-started.html

3. **语音识别插件文档**
   https://mp.weixin.qq.com/wxopen/pluginbasicprofile?action=intro&appid=wx069ba97219f66d99

4. **ECharts 微信小程序版**
   https://github.com/ecomfe/echarts-for-weixin

---

### 🎥 视频教程（搜索关键词）

- "微信小程序云开发入门"
- "微信小程序实战教程"
- "云函数开发教程"

---

### 💬 社区支持

- **微信开放社区**：https://developers.weixin.qq.com/community/
- **搜索技巧**：关键词 + "微信小程序"

---

## 十、项目目录结构预览

```
TimeRecord/
├── miniprogram/                 # 小程序前端
│   ├── pages/
│   │   ├── index/              # 录音页
│   │   ├── record-edit/        # 编辑页
│   │   ├── daily/              # 日视图
│   │   ├── weekly/             # 周视图
│   │   ├── monthly/            # 月视图
│   │   └── settings/           # 设置页
│   ├── components/             # 组件
│   │   ├── record-item/
│   │   ├── tag-selector/
│   │   ├── time-picker/
│   │   └── chart-view/
│   ├── utils/                  # 工具函数
│   │   ├── time.js            # 时间处理
│   │   └── format.js          # 格式化
│   ├── app.js
│   ├── app.json
│   └── app.wxss
├── cloudfunctions/             # 云函数
│   ├── recordSave/
│   ├── recordUpdate/
│   ├── recordDelete/
│   ├── getTimeline/
│   ├── getStats/
│   ├── saveSummary/
│   ├── exportData/
│   ├── syncTags/
│   └── checkBlankTime/
└── docs/                       # 文档
    ├── design.md              # 本设计文档
    ├── rs.md                  # 需求规格说明书
    ├── api.md                 # API 文档（待创建）
    └── changelog.md           # 更新日志（待创建）
```

---

## 附录：核心设计亮点

### ✨ 技术选型合理
- 微信云开发一体化方案，零后端运维成本
- 云函数 + 云数据库 + 云存储完整闭环
- 原生语音识别，无额外费用

### ✨ 架构清晰
- 5个核心数据库集合，覆盖所有业务场景
- 9个云函数模块，职责明确
- 6个页面，交互流程顺畅

### ✨ 迭代式开发
- MVP → 功能完善 → 优化上线，风险可控
- 6周完成开发，适合小团队或个人

### ✨ 成本低廉
- 前期完全免费
- 后期运营成本 < 50元/月（500用户以内）

---

## 🎯 给技术小白的建议

1. **不要追求完美，先做出来**
   - 第一版不需要所有功能，核心流程跑通即可
   - 从 "录音 → 识别 → 保存 → 查看" 开始

2. **善用官方文档**
   - 微信小程序文档非常详细，遇到问题先查文档
   - 云开发有完整的示例代码可以参考

3. **边学边做**
   - 不要等学完所有知识再开始
   - 遇到具体问题再去针对性学习

4. **版本控制很重要**
   - 使用 Git 管理代码（强烈推荐）
   - 每完成一个功能就提交一次

5. **多测试，早测试**
   - 开发完一个功能立即测试
   - 邀请朋友体验，收集真实反馈

---

**文档结束**

如有疑问，可随时查阅本文档或咨询开发者。

祝开发顺利！🚀
